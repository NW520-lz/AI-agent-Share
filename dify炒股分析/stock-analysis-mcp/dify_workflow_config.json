{
  "dify_workflow_template": {
    "name": "è‚¡ç¥¨åˆ†æå·¥ä½œæµ",
    "description": "ä½¿ç”¨æœ¬åœ°APIè¿›è¡Œè‚¡ç¥¨æŠ€æœ¯åˆ†æ",
    "nodes": [
      {
        "id": "start",
        "type": "start",
        "name": "å¼€å§‹",
        "data": {
          "inputs": [
            {
              "variable": "stock_code",
              "type": "text",
              "required": true,
              "label": "è‚¡ç¥¨ä»£ç ",
              "description": "è¯·è¾“å…¥6ä½è‚¡ç¥¨ä»£ç ï¼Œå¦‚600132"
            }
          ]
        }
      },
      {
        "id": "variable_aggregator",
        "type": "variable-aggregator", 
        "name": "å˜é‡èšåˆå™¨",
        "data": {
          "variables": [
            {
              "variable": "stock_code",
              "value_selector": ["start", "stock_code"]
            }
          ],
          "output": {
            "variable": "processed_stock_code",
            "type": "string"
          }
        }
      },
      {
        "id": "http_request",
        "type": "http-request",
        "name": "è‚¡ç¥¨åˆ†æAPI",
        "data": {
          "method": "POST",
          "url": "http://localhost:8003/analyze-stock",
          "headers": {
            "Content-Type": "application/json"
          },
          "body": {
            "stock_code": "{{#variable_aggregator.processed_stock_code#}}",
            "market_type": "A",
            "period": "30"
          },
          "timeout": 120,
          "max_retries": 2
        }
      },
      {
        "id": "condition",
        "type": "if-else",
        "name": "ç»“æœåˆ¤æ–­",
        "data": {
          "conditions": [
            {
              "id": "success",
              "logical_operator": "and",
              "conditions": [
                {
                  "variable_selector": ["http_request", "body", "status"],
                  "comparison_operator": "is",
                  "value": "success"
                }
              ]
            }
          ]
        }
      },
      {
        "id": "code_success",
        "type": "code",
        "name": "æ ¼å¼åŒ–åˆ†æç»“æœ",
        "data": {
          "code_language": "python3",
          "code": "def main(http_response: dict) -> dict:\n    \"\"\"æ ¼å¼åŒ–è‚¡ç¥¨åˆ†æç»“æœ\"\"\"\n    \n    data = http_response.get('data', {})\n    stock_info = data.get('stock_info', {})\n    technical = data.get('technical_summary', {})\n    \n    # æ ¼å¼åŒ–åˆ†ææŠ¥å‘Š\n    report = f\"\"\"ğŸ“Š è‚¡ç¥¨åˆ†ææŠ¥å‘Š - {stock_info.get('name', 'N/A')} ({stock_info.get('code', 'N/A')})\n\nğŸ’° å½“å‰ä»·æ ¼: {stock_info.get('current_price', 'N/A')} å…ƒ\nğŸ“ˆ æ¶¨è·Œå¹…: {stock_info.get('change_percent', 'N/A')}%\n\nğŸ“Š è¶‹åŠ¿åˆ†æ: {technical.get('trend', 'N/A')}\n\nğŸ“ˆ ç§»åŠ¨å¹³å‡çº¿:\n   MA5:  {technical.get('ma5', 'N/A')} å…ƒ\n   MA10: {technical.get('ma10', 'N/A')} å…ƒ\n   MA20: {technical.get('ma20', 'N/A')} å…ƒ\n\nğŸ¯ æŠ€æœ¯æŒ‡æ ‡:\n   RSI: {technical.get('rsi', 'N/A')}\n\nğŸ¯ å…³é”®ä½ç½®:\n   æ”¯æ’‘ä½: {', '.join(map(str, technical.get('support_levels', [])))}\n   é˜»åŠ›ä½: {', '.join(map(str, technical.get('resistance_levels', [])))}\n\nâš ï¸ ä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒï¼ŒæŠ•èµ„æœ‰é£é™©ï¼\"\"\"\n    \n    return {\n        'analysis_result': report,\n        'stock_name': stock_info.get('name', 'N/A'),\n        'current_price': stock_info.get('current_price', 'N/A'),\n        'trend': technical.get('trend', 'N/A'),\n        'rsi': technical.get('rsi', 'N/A')\n    }",
          "inputs": {
            "http_response": "{{#http_request.body#}}"
          },
          "outputs": [
            "analysis_result",
            "stock_name", 
            "current_price",
            "trend",
            "rsi"
          ]
        }
      },
      {
        "id": "code_error",
        "type": "code",
        "name": "å¤„ç†é”™è¯¯",
        "data": {
          "code_language": "python3",
          "code": "def main(http_response: dict) -> dict:\n    \"\"\"å¤„ç†APIé”™è¯¯å“åº”\"\"\"\n    \n    error_msg = http_response.get('error', 'æœªçŸ¥é”™è¯¯')\n    \n    return {\n        'analysis_result': f'âŒ è‚¡ç¥¨åˆ†æå¤±è´¥: {error_msg}\\n\\nğŸ’¡ è¯·æ£€æŸ¥:\\n- è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®ï¼ˆ6ä½æ•°å­—ï¼‰\\n- APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\\n- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸',\n        'error': error_msg\n    }",
          "inputs": {
            "http_response": "{{#http_request.body#}}"
          },
          "outputs": [
            "analysis_result",
            "error"
          ]
        }
      },
      {
        "id": "end",
        "type": "end",
        "name": "ç»“æŸ",
        "data": {
          "outputs": [
            {
              "variable": "analysis_result",
              "type": "text"
            }
          ]
        }
      }
    ],
    "edges": [
      {
        "source": "start",
        "target": "variable_aggregator"
      },
      {
        "source": "variable_aggregator", 
        "target": "http_request"
      },
      {
        "source": "http_request",
        "target": "condition"
      },
      {
        "source": "condition",
        "target": "code_success",
        "condition": "success"
      },
      {
        "source": "condition",
        "target": "code_error",
        "condition": "else"
      },
      {
        "source": "code_success",
        "target": "end"
      },
      {
        "source": "code_error", 
        "target": "end"
      }
    ]
  },
  
  "configuration_notes": {
    "api_server": {
      "url": "http://localhost:8003",
      "startup_command": "python -m uvicorn api_server:app --host 0.0.0.0 --port 8003",
      "health_check": "http://localhost:8003/health"
    },
    "http_request_settings": {
      "timeout": "120ç§’ï¼ˆé‡è¦ï¼šè‚¡ç¥¨æ•°æ®è·å–éœ€è¦æ—¶é—´ï¼‰",
      "retries": "2æ¬¡",
      "headers": {
        "Content-Type": "application/json"
      }
    },
    "supported_stock_codes": [
      "600132 (é‡åº†å•¤é…’)",
      "000001 (å¹³å®‰é“¶è¡Œ)", 
      "600000 (æµ¦å‘é“¶è¡Œ)",
      "300001 (ç‰¹é”å¾·)"
    ],
    "docker_configuration": {
      "note": "å¦‚æœDifyè¿è¡Œåœ¨Dockerä¸­ï¼Œè¯·å°†URLæ”¹ä¸º",
      "url": "http://host.docker.internal:8003/analyze-stock"
    }
  }
}
